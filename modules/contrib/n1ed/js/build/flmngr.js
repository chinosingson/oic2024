!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.flmngr=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,n)=>{e.exports=n("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/typing.js":(e,t,n)=>{e.exports=n("dll-reference CKEditor5.dll")("./src/typing.js")},"ckeditor5/src/ui.js":(e,t,n)=>{e.exports=n("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,n)=>{e.exports=n("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};return(()=>{"use strict";n.d(i,{default:()=>g});var e=n("ckeditor5/src/core.js"),t=n("ckeditor5/src/ui.js"),s=n("ckeditor5/src/utils.js"),r=n("ckeditor5/src/typing.js");function o(e,t,n,i,s){const r=e.plugins.get("Notification"),o=e.locale.t;r?r.showWarning(s?o(i):i,{title:n?o(t):t,namespace:"flmngr"}):alert((n?o(t):t)+"\n\n"+s?o(i):i)}class l extends e.Command{static flmngr;imageExtensions=["jpeg","jpg","png","bmp","svg","webp"];constructor(e){super(e),this.stopListening(this.editor.model.document,"change"),this.listenTo(this.editor.model.document,"change",(()=>this.refresh()),{priority:"low"})}refresh(){const e=this.editor.commands.get("insertImage"),t=this.editor.commands.get("link");this.isEnabled=!e||e.isEnabled||!!t&&t.isEnabled}isImage(e){let t=e.lastIndexOf(".");if(t>-1&&t<e.length-1){let n=e.substr(t+1).toLowerCase();return"jpeg"===n||"jpg"===n||"png"===n||"gif"===n||"bmp"===n||"svg"===n||"webp"===n}return!1}executeUpload(){this.execute2(!0)}execute(){this.execute2(!1)}execute2(e){if(!this.editor.commands.get("insertImage")){let e="Please enable CKEditor 5 `Image` plugin in order to use Flmngr file manager";return window.Drupal&&(e+=":\n\nDrupal users must set `Image Upload` -> `Enable image uploads` checkbox on the page of CKEditor 5 text format"),void alert(e)}if(!l.flmngr)return void console.log("File manager is not loaded yet");const t=this.editor.model.document.selection,n=t.getSelectedElement()||(0,s.first)(t.getSelectedBlocks());let i=null,d=null;const a=t.getFirstPosition();t.hasAttribute("linkHref")&&(d=(0,r.findAttributeRange)(a,"linkHref",t.getAttribute("linkHref"),this.editor.model).getItems().next().value.textNode,i=d.getAttribute("linkHref"));let c=null;!n||"imageBlock"!==n.name&&"imageInline"!==n.name||(c=n,i=c.getAttribute("src"),d=null),e?l.flmngr.selectFiles({acceptExtensions:c?this.imageExtensions:null,isMultiple:!1,onFinish:e=>{l.flmngr.upload({filesOrLinks:e,onFinish:(e,t)=>{this.createOrChange(n,c,d,e)},onFail:e=>{o(this.editor,"Unable to upload files",!0,e,!1)}})}}):l.flmngr.pickFiles({acceptExtensions:c?this.imageExtensions:null,isMultiple:!1,list:i?[i]:null,onFinish:e=>{this.createOrChange(n,c,d,e.map((e=>e.url)))}})}createOrChange(e,t,n,i){if(t)this.changeImgSrc(t,l.flmngr.getNoCacheUrl(i[0]));else if(n)this.changeAHref(n,i[0]);else{let e=[],t=[];for(let n of i)this.isImage(n)?e.push(l.flmngr.getNoCacheUrl(n)):t.push(n);for(const e of t)this.createNewA(e);for(const t of e)this.createNewImg(t)}}createNewImg(e){this.editor.model.change((t=>{this.editor.commands.get("insertImage").isEnabled?this.editor.execute("insertImage",{source:[e]}):o(this.editor,"Inserting image failed",!0,"Could not insert image at the current position.",!0)}))}createNewA(e){this.editor.model.change((t=>{const n=this.editor.model.document.selection.getFirstPosition(),i=e.lastIndexOf("/"),s="Download "+e.substr(i+1);t.insertText(s,{linkHref:e},n)}))}changeImgSrc(e,t){this.editor.model.change((n=>{n.setAttribute("src",t,e),n.removeAttribute("srcset",e),n.removeAttribute("sizes",e);let i=e.getAttribute("htmlAttributes");i&&(delete i.attributes.src,delete i.attributes.srcset,delete i.attributes.sizes,n.setAttribute("htmlAttributes",i,e))}))}changeAHref(e,t){this.editor.model.change((n=>{n.setAttribute("linkHref",t,e)}))}isImage(e){let t=e.lastIndexOf(".");if(t>-1&&t<e.length-1){let n=e.substr(t+1).toLowerCase();if(this.imageExtensions.indexOf(n)>-1)return!0}return!1}}class d extends e.Command{static flmngr;constructor(e){super(e),this.stopListening(this.editor.model.document,"change"),this.listenTo(this.editor.model.document,"change",(()=>this.refresh()),{priority:"low"})}getSelectedImage(){const e=this.editor.model.document.selection,t=e.getSelectedElement()||(0,s.first)(e.getSelectedBlocks());return!t||"imageBlock"!==t.name&&"imageInline"!==t.name?null:t}refresh(){this.isEnabled=null!=this.getSelectedImage()}execute(){if(!d.flmngr)return void console.log("File manager is not loaded yet");const e=this.getSelectedImage();d.flmngr.editImageAndUpload({url:e.getAttribute("src"),onSave:t=>{this.changeImgSrc(e,d.flmngr.getNoCacheUrl(t))},onFail:e=>{const t=editor.plugins.get("Notification"),n=editor.locale.t;t.showWarning(e,{title:n("Uploading edited image to server failed"),namespace:"flmngr"})}})}changeImgSrc(e,t){this.editor.model.change((n=>{n.setAttribute("src",t,e),n.removeAttribute("srcset",e),n.removeAttribute("sizes",e);let i=e.getAttribute("htmlAttributes");i&&(delete i.attributes.src,delete i.attributes.srcset,delete i.attributes.sizes,n.setAttribute("htmlAttributes",i,e))}))}}class a extends l{execute(){this.editor.commands.get("upload").executeUpload()}}class c extends e.Plugin{listenersFlmngrIsReady=[];static get pluginName(){return"Flmngr"}static get requires(){return[t.Notification]}setFlmngr(e){const t=this.editor.config.get("flmngr")||this.editor.config.get("Flmngr")||{};t.integration=t.integration||"ckeditor5",t.integrationType="flmngr";let n=e.create(t);l.flmngr=n,d.flmngr=n;let i=n,s=!!i.getNewAPI&&i.getNewAPI();this.editor.getFlmngr=e=>(e(s,i),i);for(const e of this.listenersFlmngrIsReady)e(s,i);window.FlmngrCKEditor5=n.getNewAPI()}init(){this.editor.getFlmngr=e=>(e&&this.listenersFlmngrIsReady.push(e),null);const e=this.editor.config.get("flmngr.apiKey")||this.editor.config.get("Flmngr.apiKey")||"FLMNFLMN";if(window.flmngr)this.setFlmngr(window.flmngr);else{window.onFlmngrAndImgPenLoadedArray||(window.onFlmngrAndImgPenLoadedArray=[]),window.onFlmngrAndImgPenLoadedArray.push((()=>{this.setFlmngr(window.flmngr)}));let t=this.editor.config.get("flmngr.libLoadDelay")||this.editor.config.get("Flmngr.libLoadDelay");t&&parseInt(t)==t||(t=1),setTimeout((()=>{c.includeJS("https://cloud.flmngr.com/cdn/"+e+"/flmngr.js"),c.includeJS("https://cloud.flmngr.com/cdn/"+e+"/imgpen.js")}),t)}this.editor.commands.add("upload",new a(this.editor)),this.editor.commands.add("flmngr",new l(this.editor)),this.editor.commands.add("imgpen",new d(this.editor));const n=this.editor.ui.componentFactory,i=this.editor.t;n.add("upload",(e=>{const n=this.editor.commands.get("upload"),s=new t.ButtonView(e);return s.set({label:i("Upload image or file"),icon:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   xmlns:dc="http://purl.org/dc/elements/1.1/"\n   xmlns:cc="http://creativecommons.org/ns#"\n   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n   xmlns:svg="http://www.w3.org/2000/svg"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   width="20"\n   height="20"\n   viewBox="0 0 20 20">\n  <path\n     style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n     d="m 10.130856,2.2749367 7.546402,7.5464016"\n   />\n  <path\n     style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n     d="M 10.849606,1.5561867 2.5844542,9.8213386"\n   />\n  <path\n     style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n     d="M 10,2 V 19"\n   />\n</svg>\n',tooltip:!0}),s.bind("isEnabled").to(n),s.on("execute",(()=>{this.editor.execute("upload"),this.editor.editing.view.focus()})),s})),n.add("flmngr",(e=>{const n=this.editor.commands.get("flmngr"),s=new t.ButtonView(e);return s.set({label:i("Browse image or file"),icon:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   xmlns:dc="http://purl.org/dc/elements/1.1/"\n   xmlns:cc="http://creativecommons.org/ns#"\n   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n   xmlns:svg="http://www.w3.org/2000/svg"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   version="1.1"\n   width="20"\n   height="20"\n   viewBox="0 0 20 20"\n>\n  <g\n     transform="translate(0,2)">\n    <path\n       style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:2;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"\n       d="m 3.7210133,2 h 5 l 1.9999997,3 h 8 L 16.609922,15 H 1.2099223 Z"\n     />\n  </g>\n</svg>\n',tooltip:!0}),s.bind("isEnabled").to(n),s.on("execute",(()=>{this.editor.execute("flmngr"),this.editor.editing.view.focus()})),s})),n.add("imgpen",(e=>{const n=this.editor.commands.get("imgpen"),s=new t.ButtonView(e);return s.set({label:i("Edit image"),icon:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   xmlns:dc="http://purl.org/dc/elements/1.1/"\n   xmlns:cc="http://creativecommons.org/ns#"\n   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n   xmlns:svg="http://www.w3.org/2000/svg"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   version="1.1"\n   width="20"\n   height="20"\n   viewBox="0 0 20 20"\n>\n  <path\n     style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n     d="M 1,16 H 16 V 1"\n  />\n  <path\n     style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n     d="M 19,4 H 4 v 15"\n   />\n  <path\n     style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n     d="M 15,16 7,8 4,11"\n  />\n  <path\n     style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:bevel;stroke-opacity:1"\n     d="m 12,8 h 1 V 7 h -1 z"\n  />\n</svg>\n',tooltip:!0}),s.bind("isEnabled").to(n),s.on("execute",(()=>{this.editor.execute("imgpen"),this.editor.editing.view.focus()})),s}))}static includeJS(e){let t=document.getElementsByTagName("script"),n=!1,i=null;for(let s=0;s<t.length;s++){let r=decodeURI(t[s].getAttribute("src"));null!=r&&-1!==r.indexOf(e)&&(n=!0,i=t[s])}if(n)return null;{let t=document.createElement("script");return t.type="text/javascript",t.src=e,t.setAttribute("data-by-n1ed","true"),document.getElementsByTagName("head")[0].appendChild(t),t}}}const g={Flmngr:c}})(),i=i.default})()));